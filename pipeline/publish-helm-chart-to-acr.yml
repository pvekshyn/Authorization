steps:
  - task: HelmDeploy@0
    displayName: Helm package
    inputs:
      connectionType: Kubernetes Service Connection
      kubernetesServiceConnection: pvauthorizationaks-sc
      command: package
      chartPath: pipeline/helm/api-service
      destination: $(Build.ArtifactStagingDirectory)

  - task: HelmDeploy@0
    displayName: Helm push
    inputs:
      connectionType: Kubernetes Service Connection
      kubernetesServiceConnection: pvauthorizationaks-sc
      azureSubscriptionForACR: authorization_sc
      azureResourceGroupForACR: authorization-rg
      azureContainerRegistry: pvauthorizationcr.azurecr.io
      command: push
      arguments: "$(Build.ArtifactStagingDirectory)/api-service-1.0.0.tgz oci://pvauthorizationcr.azurecr.io/helm"